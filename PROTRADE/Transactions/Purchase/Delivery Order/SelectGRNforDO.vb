
Imports BL
Imports System.Windows.Forms

Public Class SelectGRNforDO
    Public PARTYNAME As String = ""
    Public DT1 As New DataTable
    Public GODOWN As String = ""
    Public DODATE As Date

    Private Sub cmdexit_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdexit.Click
        Me.Close()
    End Sub

    Private Sub SelectGRNforDO_KeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles Me.KeyDown
        If e.KeyCode = Windows.Forms.Keys.Escape Then
            Me.Close()
        ElseIf e.KeyCode = Keys.Enter Then
            SendKeys.Send("{Tab}")
        End If
    End Sub

    Private Sub SelectGRNforDO_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        fillgrid()
    End Sub

    Sub fillgrid(Optional ByVal where As String = "")
        Try
            Cursor.Current = Cursors.WaitCursor

            where = where & " and DATE<= '" & Format(DODATE.Date, "MM/dd/yyyy") & "'"
            If GODOWN <> "" Then where = where & " AND GODOWN = '" & GODOWN & "'"

            Dim objclspreq As New ClsCommon()
            'HERE DONT FETCH DATA FROM STOCKVIEW, COZ IF WE FETCH FROM STOCKVIEW THEN ALL THE MATERIAL WHICH ARE OUT BUT 
            'LIFTTING IS NOT ENTERED WILL BE SHOWN AGAIN
            'EG IF THERE IS A LRNO 'J1918' AND WE HAVE MADE DEIVERYORDER OF THAT, BUT STILL LIFTING DATE IS PENDING THEN 
            'IT WILL BE VISIBLE IN WAREHOUSE STOCK, BUT IT SHOULD NOT BE SHOWN IN THIS SELECTDO FORM
            'SO W HAVE TO SKIP THE LIFTING DATE CLAUSE FOR THIS SELECTDO 
            'Dim DT1 As DataTable = objclspreq.search(" CAST (0 AS BIT) AS CHK ,NO,DATE, NAME, GODOWN,MILLNAME,TRANSPORT,QUALITY,BAGS,WT, CONES,LRNO,LRDATE,SRNO,GRIDTYPE", "", "   STOCKVIEW ", "  AND BAGS > 0 AND YEARID = " & YearId & where)

            'WE HAVE CREATED NEW VIEW
            'Dim DT1 As DataTable = objclspreq.search(" CAST (0 AS BIT) AS CHK , T.* ", "", "(SELECT STOCKMASTER.SM_NO AS NO, YEARMASTER.year_startdate AS DATE, LEDGERS.Acc_cmpname AS NAME, ISNULL(GODOWNMASTER.GODOWN_NAME, '') AS GODOWN, ISNULL(TRANSPORT.Acc_cmpname, '') AS TRANSPORT, ISNULL(MILLNAME.Acc_cmpname, '') AS MILLNAME, STOCKMASTER.SM_NO AS SRNO,  ISNULL(QUALITYMASTER.QUALITY_NAME, '') AS QUALITY, ISNULL(STOCKMASTER.SM_BAGS - STOCKMASTER.SM_OUTBAGS, 0) AS BAGS, ISNULL(STOCKMASTER.SM_WT, 0) - ISNULL(STOCKMASTER.SM_OUTWT, 0) AS WT, ISNULL(STOCKMASTER.SM_LOTNO,'') AS LOTNO, ISNULL(COLORMASTER.COLOR_NAME,'') AS COLOR, STOCKMASTER.SM_CONES - STOCKMASTER.SM_OUTCONES AS CONES, ISNULL(STOCKMASTER.SM_LRNO, '') AS LRNO, CAST(STOCKMASTER.SM_LRDATE AS VARCHAR(10)) AS LRDATE, 'OPENING' AS GRIDTYPE, STOCKMASTER.SM_CMPID AS CMPID, STOCKMASTER.SM_YEARID AS YEARID FROM STOCKMASTER INNER JOIN LEDGERS ON STOCKMASTER.SM_LEDGERID = LEDGERS.Acc_id INNER JOIN YEARMASTER ON STOCKMASTER.SM_YEARID = YEARMASTER.year_id LEFT OUTER JOIN QUALITYMASTER ON STOCKMASTER.SM_QUALITYID = QUALITYMASTER.QUALITY_ID LEFT OUTER JOIN LEDGERS AS TRANSPORT ON STOCKMASTER.SM_TRANSID = TRANSPORT.Acc_id LEFT OUTER JOIN GODOWNMASTER ON STOCKMASTER.SM_GODOWNID = GODOWNMASTER.GODOWN_ID LEFT OUTER JOIN LEDGERS AS MILLNAME ON STOCKMASTER.SM_MILLID = MILLNAME.Acc_id LEFT OUTER JOIN COLORMASTER ON COLOR_ID = STOCKMASTER.SM_SHADEID where(STOCKMASTER.SM_BAGS - STOCKMASTER.SM_OUTBAGS > 0) AND STOCKMASTER.SM_YEARID = " & YearId & " UNION ALL  SELECT GRN.grn_no AS NO, GRN.grn_date AS DATE, LEDGERS.Acc_cmpname AS NAME, ISNULL(GODOWNMASTER.GODOWN_NAME, '') AS GODOWN, ISNULL(TRANSPORT.Acc_cmpname, '') AS TRANSPORT, ISNULL(MILLNAME.Acc_cmpname, '') AS MILLNAME, GRN_DESC.GRN_GRIDSRNO AS SRNO,  ISNULL(QUALITYMASTER.QUALITY_NAME, '') AS QUALITY, ISNULL(GRN_DESC.GRN_BAGS - GRN_DESC.GRN_OUTBAGS, 0) AS BAGS, ISNULL(GRN_DESC.GRN_WT,0) - ISNULL(GRN_DESC.GRN_OUTWT, 0) AS WT, ISNULL(GRN_DESC.GRN_GRIDLOTNO,'') AS LOTNO, ISNULL(COLORMASTER.COLOR_NAME,'') AS COLOR, ISNULL(GRN_DESC.GRN_CONES - GRN_DESC.GRN_OUTCONES, 0) AS CONES, ISNULL(GRN_DESC.GRN_LRNO, '') AS LRNO, CAST(GRN_DESC.GRN_LRDATE AS VARCHAR(10)) AS LRDATE, 'GRN' AS GRIDTYPE, GRN.GRN_CMPID AS CMPID, GRN.grn_yearid AS YEARID FROM GRN INNER JOIN GRN_DESC ON GRN.grn_no = GRN_DESC.GRN_NO AND GRN.grn_yearid = GRN_DESC.GRN_YEARID INNER JOIN LEDGERS ON GRN.grn_ledgerid = LEDGERS.Acc_id AND GRN.grn_yearid = LEDGERS.Acc_yearid LEFT OUTER JOIN QUALITYMASTER ON GRN_DESC.GRN_YEARID = QUALITYMASTER.QUALITY_YEARID AND GRN_DESC.GRN_QUALITYID = QUALITYMASTER.QUALITY_ID LEFT OUTER JOIN LEDGERS AS TRANSPORT ON GRN.grn_yearid = TRANSPORT.Acc_yearid AND GRN.grn_transledgerid = TRANSPORT.Acc_id LEFT OUTER JOIN LEDGERS AS MILLNAME ON GRN.grn_yearid = MILLNAME.Acc_yearid AND GRN.GRN_MILLID = MILLNAME.Acc_id LEFT OUTER JOIN GODOWNMASTER ON GRN.grn_yearid = GODOWNMASTER.GODOWN_YEARID AND GRN.GRN_GODOWNID = GODOWNMASTER.GODOWN_ID LEFT OUTER JOIN COLORMASTER ON COLOR_ID = GRN_DESC.GRN_SHADEID WHERE (GRN_DESC.GRN_BAGS - GRN_DESC.GRN_OUTBAGS > 0) AND GRN_TYPE = 'YARN' AND GRN.GRN_YEARID = " & YearId & " UNION ALL  SELECT SALERETURN.SALRET_no AS NO, SALERETURN.SALRET_date AS DATE, LEDGERS.Acc_cmpname AS NAME, ISNULL(GODOWNMASTER.GODOWN_NAME, '') AS GODOWN, ISNULL(TRANSPORT.Acc_cmpname, '') AS TRANSPORT, '' AS MILLNAME, SALERETURN_DESC.SALRET_SRNO AS SRNO,  ISNULL(QUALITYMASTER.QUALITY_NAME, '') AS QUALITY, ISNULL(SALERETURN_DESC.SALRET_PCS - SALERETURN_DESC.SALRET_OUTPCS, 0) AS BAGS, ISNULL(SALERETURN_DESC.SALRET_MTRS,0) - ISNULL(SALERETURN_DESC.SALRET_OUTMTRS, 0) AS WT, '' AS LOTNO, '' AS COLOR, 0 AS CONES, ISNULL(SALERETURN.SALRET_DONO, '') AS LRNO, CAST(SALERETURN.SALRET_DODATE AS VARCHAR(10)) AS LRDATE, 'SALERETURN' AS GRIDTYPE, SALERETURN.SALRET_CMPID AS CMPID, SALERETURN.SALRET_yearid AS YEARID FROM SALERETURN INNER JOIN SALERETURN_DESC ON SALERETURN.SALRET_no = SALERETURN_DESC.SALRET_NO AND SALERETURN.SALRET_yearid = SALERETURN_DESC.SALRET_YEARID INNER JOIN LEDGERS ON SALERETURN.SALRET_ledgerid = LEDGERS.Acc_id AND SALERETURN.SALRET_yearid = LEDGERS.Acc_yearid LEFT OUTER JOIN QUALITYMASTER ON SALERETURN_DESC.SALRET_YEARID = QUALITYMASTER.QUALITY_YEARID AND SALERETURN_DESC.SALRET_QUALITYID = QUALITYMASTER.QUALITY_ID LEFT OUTER JOIN LEDGERS AS TRANSPORT ON SALERETURN.SALRET_yearid = TRANSPORT.Acc_yearid AND SALERETURN.SALRET_TRANSID = TRANSPORT.Acc_id LEFT OUTER JOIN GODOWNMASTER ON SALERETURN.SALRET_yearid = GODOWNMASTER.GODOWN_YEARID AND SALERETURN.SALRET_GODOWNID = GODOWNMASTER.GODOWN_ID WHERE (SALERETURN_DESC.SALRET_PCS - SALERETURN_DESC.SALRET_OUTPCS)> 0 AND SALRET_TYPE = 'YARN' AND SALERETURN.SALRET_YEARID = " & YearId & " UNION ALL SELECT YARNRETURNSIZER.YRETSIZER_NO AS NO, YARNRETURNSIZER.YRETSIZER_date AS DATE, LEDGERS.Acc_cmpname AS NAME, ISNULL(GODOWNMASTER.GODOWN_NAME, '') AS GODOWN, ISNULL(TRANSPORT.Acc_cmpname, '') AS TRANSPORT, '' AS MILLNAME, YARNRETURNSIZER_DESC.YRETSIZER_GRIDSRNO AS SRNO,  ISNULL(QUALITYMASTER.QUALITY_NAME, '') AS QUALITY, ISNULL(YARNRETURNSIZER_DESC.YRETSIZER_BAGS, 0) AS BAGS, ISNULL(YARNRETURNSIZER_DESC.YRETSIZER_WT - YARNRETURNSIZER_DESC.YRETSIZER_OUTWT,0) AS WT, ISNULL(YRETSIZER_LOTNO,'') AS LOTNO, ISNULL(COLOR_NAME,'') AS COLOR, 0 AS CONES, '' AS LRNO, CAST(YARNRETURNSIZER.YRETSIZER_DATE AS VARCHAR(10)) AS LRDATE, 'YARNRETURNSIZER' AS GRIDTYPE, YARNRETURNSIZER.YRETSIZER_CMPID AS CMPID, YARNRETURNSIZER.YRETSIZER_yearid AS YEARID FROM YARNRETURNSIZER INNER JOIN YARNRETURNSIZER_DESC ON YARNRETURNSIZER.YRETSIZER_no = YARNRETURNSIZER_DESC.YRETSIZER_NO AND YARNRETURNSIZER.YRETSIZER_yearid = YARNRETURNSIZER_DESC.YRETSIZER_YEARID INNER JOIN LEDGERS ON YARNRETURNSIZER.YRETSIZER_SIZERID = LEDGERS.Acc_id LEFT OUTER JOIN QUALITYMASTER ON YARNRETURNSIZER_DESC.YRETSIZER_QUALITYID = QUALITYMASTER.QUALITY_ID LEFT OUTER JOIN LEDGERS AS TRANSPORT ON YARNRETURNSIZER.YRETSIZER_TRANSID = TRANSPORT.Acc_id LEFT OUTER JOIN GODOWNMASTER ON YARNRETURNSIZER.YRETSIZER_GODOWNID = GODOWNMASTER.GODOWN_ID left outer JOIN COLORMASTER ON YARNRETURNSIZER_DESC.YRETSIZER_SHADEID = COLOR_ID WHERE (YARNRETURNSIZER_DESC.YRETSIZER_WT - YARNRETURNSIZER_DESC.YRETSIZER_OUTWT)> 0 AND YARNRETURNSIZER_DESC.YRETSIZER_YEARID = " & YearId & " UNION ALL SELECT YARNRETURNDYEING.YRETDYEING_NO AS NO, YARNRETURNDYEING.YRETDYEING_date AS DATE, LEDGERS.Acc_cmpname AS NAME, ISNULL(GODOWNMASTER.GODOWN_NAME, '') AS GODOWN, ISNULL(TRANSPORT.Acc_cmpname, '') AS TRANSPORT, '' AS MILLNAME, YARNRETURNDYEING_DESC.YRETDYEING_GRIDSRNO AS SRNO,  ISNULL(QUALITYMASTER.QUALITY_NAME, '') AS QUALITY, ISNULL(YARNRETURNDYEING_DESC.YRETDYEING_BAGS, 0) AS BAGS, ISNULL(YARNRETURNDYEING_DESC.YRETDYEING_WT - YARNRETURNDYEING_DESC.YRETDYEING_OUTWT,0) AS WT, ISNULL(YRETDYEING_LOTNO,'') AS LOTNO, ISNULL(COLOR_NAME,'') AS COLOR, 0 AS CONES, '' AS LRNO, CAST(YARNRETURNDYEING.YRETDYEING_DATE AS VARCHAR(10)) AS LRDATE, 'YARNRETURNDYEING' AS GRIDTYPE, YARNRETURNDYEING.YRETDYEING_CMPID AS CMPID, YARNRETURNDYEING.YRETDYEING_yearid AS YEARID FROM YARNRETURNDYEING INNER JOIN YARNRETURNDYEING_DESC ON YARNRETURNDYEING.YRETDYEING_no = YARNRETURNDYEING_DESC.YRETDYEING_NO AND YARNRETURNDYEING.YRETDYEING_yearid = YARNRETURNDYEING_DESC.YRETDYEING_YEARID INNER JOIN LEDGERS ON YARNRETURNDYEING.YRETDYEING_DYEINGID = LEDGERS.Acc_id LEFT OUTER JOIN QUALITYMASTER ON YARNRETURNDYEING_DESC.YRETDYEING_QUALITYID = QUALITYMASTER.QUALITY_ID LEFT OUTER JOIN LEDGERS AS TRANSPORT ON YARNRETURNDYEING.YRETDYEING_TRANSID = TRANSPORT.Acc_id LEFT OUTER JOIN GODOWNMASTER ON YARNRETURNDYEING.YRETDYEING_GODOWNID = GODOWNMASTER.GODOWN_ID left outer JOIN COLORMASTER ON YARNRETURNDYEING_DESC.YRETDYEING_SHADEID = COLOR_ID WHERE (YARNRETURNDYEING_DESC.YRETDYEING_WT - YARNRETURNDYEING_DESC.YRETDYEING_OUTWT)> 0 AND YARNRETURNDYEING_DESC.YRETDYEING_YEARID = " & YearId & " UNION ALL SELECT YARNRETURNJOBBER.YRETJOBBER_NO AS NO, YARNRETURNJOBBER.YRETJOBBER_date AS DATE, LEDGERS.Acc_cmpname AS NAME, ISNULL(GODOWNMASTER.GODOWN_NAME, '') AS GODOWN, ISNULL(TRANSPORT.Acc_cmpname, '') AS TRANSPORT, '' AS MILLNAME, YARNRETURNJOBBER_DESC.YRETJOBBER_GRIDSRNO AS SRNO,  ISNULL(QUALITYMASTER.QUALITY_NAME, '') AS QUALITY, ISNULL(YARNRETURNJOBBER_DESC.YRETJOBBER_BAGS, 0) AS BAGS, ISNULL(YARNRETURNJOBBER_DESC.YRETJOBBER_WT - YARNRETURNJOBBER_DESC.YRETJOBBER_OUTWT,0) AS WT, ISNULL(YRETJOBBER_LOTNO,'') AS LOTNO, ISNULL(COLOR_NAME,'') AS COLOR, 0 AS CONES, '' AS LRNO, CAST(YARNRETURNJOBBER.YRETJOBBER_DATE AS VARCHAR(10)) AS LRDATE, 'YARNRETURNJOBBER' AS GRIDTYPE, YARNRETURNJOBBER.YRETJOBBER_CMPID AS CMPID, YARNRETURNJOBBER.YRETJOBBER_yearid AS YEARID FROM YARNRETURNJOBBER INNER JOIN YARNRETURNJOBBER_DESC ON YARNRETURNJOBBER.YRETJOBBER_no = YARNRETURNJOBBER_DESC.YRETJOBBER_NO AND YARNRETURNJOBBER.YRETJOBBER_yearid = YARNRETURNJOBBER_DESC.YRETJOBBER_YEARID INNER JOIN LEDGERS ON YARNRETURNJOBBER.YRETJOBBER_JOBBERID = LEDGERS.Acc_id LEFT OUTER JOIN QUALITYMASTER ON YARNRETURNJOBBER_DESC.YRETJOBBER_QUALITYID = QUALITYMASTER.QUALITY_ID LEFT OUTER JOIN LEDGERS AS TRANSPORT ON YARNRETURNJOBBER.YRETJOBBER_TRANSID = TRANSPORT.Acc_id LEFT OUTER JOIN GODOWNMASTER ON YARNRETURNJOBBER.YRETJOBBER_GODOWNID = GODOWNMASTER.GODOWN_ID left outer JOIN COLORMASTER ON YARNRETURNJOBBER_DESC.YRETJOBBER_SHADEID = COLOR_ID WHERE (YARNRETURNJOBBER_DESC.YRETJOBBER_WT - YARNRETURNJOBBER_DESC.YRETJOBBER_OUTWT)> 0  AND YARNRETURNJOBBER_DESC.YRETJOBBER_YEARID = " & YearId & " UNION ALL SELECT YARNRETURNMACHINE.YRETMACHINE_NO AS NO, YARNRETURNMACHINE.YRETMACHINE_date AS DATE, LEDGERS.Acc_cmpname AS NAME, ISNULL(GODOWNMASTER.GODOWN_NAME, '') AS GODOWN, ISNULL(TRANSPORT.Acc_cmpname, '') AS TRANSPORT, '' AS MILLNAME, YARNRETURNMACHINE_DESC.YRETMACHINE_GRIDSRNO AS SRNO,  ISNULL(QUALITYMASTER.QUALITY_NAME, '') AS QUALITY, ISNULL(YARNRETURNMACHINE_DESC.YRETMACHINE_BAGS, 0) AS BAGS, ISNULL(YARNRETURNMACHINE_DESC.YRETMACHINE_WT - YARNRETURNMACHINE_DESC.YRETMACHINE_OUTWT,0) AS WT, ISNULL(YRETMACHINE_LOTNO,'') AS LOTNO, ISNULL(COLOR_NAME,'') AS COLOR, 0 AS CONES, '' AS LRNO, CAST(YARNRETURNMACHINE.YRETMACHINE_DATE AS VARCHAR(10)) AS LRDATE, 'YARNRETURNMACHINE' AS GRIDTYPE, YARNRETURNMACHINE.YRETMACHINE_CMPID AS CMPID, YARNRETURNMACHINE.YRETMACHINE_yearid AS YEARID FROM YARNRETURNMACHINE INNER JOIN YARNRETURNMACHINE_DESC ON YARNRETURNMACHINE.YRETMACHINE_no = YARNRETURNMACHINE_DESC.YRETMACHINE_NO AND YARNRETURNMACHINE.YRETMACHINE_yearid = YARNRETURNMACHINE_DESC.YRETMACHINE_YEARID INNER JOIN LEDGERS ON YARNRETURNMACHINE.YRETMACHINE_MACHINEID = LEDGERS.Acc_id LEFT OUTER JOIN QUALITYMASTER ON YARNRETURNMACHINE_DESC.YRETMACHINE_QUALITYID = QUALITYMASTER.QUALITY_ID LEFT OUTER JOIN LEDGERS AS TRANSPORT ON YARNRETURNMACHINE.YRETMACHINE_TRANSID = TRANSPORT.Acc_id LEFT OUTER JOIN GODOWNMASTER ON YARNRETURNMACHINE.YRETMACHINE_GODOWNID = GODOWNMASTER.GODOWN_ID left outer JOIN COLORMASTER ON YARNRETURNMACHINE_DESC.YRETMACHINE_SHADEID = COLOR_ID WHERE (YARNRETURNMACHINE_DESC.YRETMACHINE_WT - YARNRETURNMACHINE_DESC.YRETMACHINE_OUTWT)> 0  AND YARNRETURNMACHINE_DESC.YRETMACHINE_YEARID = " & YearId & " UNION ALL SELECT YARNRETURNWARPER.YRETWARPER_NO AS NO, YARNRETURNWARPER.YRETWARPER_date AS DATE, LEDGERS.Acc_cmpname AS NAME, ISNULL(GODOWNMASTER.GODOWN_NAME, '') AS GODOWN, ISNULL(TRANSPORT.Acc_cmpname, '') AS TRANSPORT, '' AS MILLNAME, YARNRETURNWARPER_DESC.YRETWARPER_GRIDSRNO AS SRNO,  ISNULL(QUALITYMASTER.QUALITY_NAME, '') AS QUALITY, ISNULL(YARNRETURNWARPER_DESC.YRETWARPER_BAGS, 0) AS BAGS, ISNULL(YARNRETURNWARPER_DESC.YRETWARPER_WT - YARNRETURNWARPER_DESC.YRETWARPER_OUTWT,0) AS WT, ISNULL(YRETWARPER_LOTNO,'') AS LOTNO, ISNULL(COLOR_NAME,'') AS COLOR, 0 AS CONES, '' AS LRNO, CAST(YARNRETURNWARPER.YRETWARPER_DATE AS VARCHAR(10)) AS LRDATE, 'YARNRETURNWARPER' AS GRIDTYPE, YARNRETURNWARPER.YRETWARPER_CMPID AS CMPID, YARNRETURNWARPER.YRETWARPER_yearid AS YEARID FROM YARNRETURNWARPER INNER JOIN YARNRETURNWARPER_DESC ON YARNRETURNWARPER.YRETWARPER_no = YARNRETURNWARPER_DESC.YRETWARPER_NO AND YARNRETURNWARPER.YRETWARPER_yearid = YARNRETURNWARPER_DESC.YRETWARPER_YEARID INNER JOIN LEDGERS ON YARNRETURNWARPER.YRETWARPER_WARPERID = LEDGERS.Acc_id LEFT OUTER JOIN QUALITYMASTER ON YARNRETURNWARPER_DESC.YRETWARPER_QUALITYID = QUALITYMASTER.QUALITY_ID LEFT OUTER JOIN LEDGERS AS TRANSPORT ON YARNRETURNWARPER.YRETWARPER_TRANSID = TRANSPORT.Acc_id LEFT OUTER JOIN GODOWNMASTER ON YARNRETURNWARPER.YRETWARPER_GODOWNID = GODOWNMASTER.GODOWN_ID left outer JOIN COLORMASTER ON YARNRETURNWARPER_DESC.YRETWARPER_SHADEID = COLOR_ID WHERE (YARNRETURNWARPER_DESC.YRETWARPER_WT - YARNRETURNWARPER_DESC.YRETWARPER_OUTWT)> 0  AND YARNRETURNWARPER_DESC.YRETWARPER_YEARID = " & YearId & " UNION ALL SELECT YARNRETURNWEAVER.YRETWEAVER_NO AS NO, YARNRETURNWEAVER.YRETWEAVER_date AS DATE, LEDGERS.Acc_cmpname AS NAME, ISNULL(GODOWNMASTER.GODOWN_NAME, '') AS GODOWN, ISNULL(TRANSPORT.Acc_cmpname, '') AS TRANSPORT, '' AS MILLNAME, YARNRETURNWEAVER_DESC.YRETWEAVER_GRIDSRNO AS SRNO,  ISNULL(QUALITYMASTER.QUALITY_NAME, '') AS QUALITY, ISNULL(YARNRETURNWEAVER_DESC.YRETWEAVER_BAGS, 0) AS BAGS, ISNULL(YARNRETURNWEAVER_DESC.YRETWEAVER_WT - YARNRETURNWEAVER_DESC.YRETWEAVER_OUTWT,0) AS WT, ISNULL(YRETWEAVER_LOTNO,'') AS LOTNO, ISNULL(COLOR_NAME,'') AS COLOR, 0 AS CONES, '' AS LRNO, CAST(YARNRETURNWEAVER.YRETWEAVER_DATE AS VARCHAR(10)) AS LRDATE, 'YARNRETURNWEAVER' AS GRIDTYPE, YARNRETURNWEAVER.YRETWEAVER_CMPID AS CMPID, YARNRETURNWEAVER.YRETWEAVER_yearid AS YEARID FROM YARNRETURNWEAVER INNER JOIN YARNRETURNWEAVER_DESC ON YARNRETURNWEAVER.YRETWEAVER_no = YARNRETURNWEAVER_DESC.YRETWEAVER_NO AND YARNRETURNWEAVER.YRETWEAVER_yearid = YARNRETURNWEAVER_DESC.YRETWEAVER_YEARID INNER JOIN LEDGERS ON YARNRETURNWEAVER.YRETWEAVER_WEAVERID = LEDGERS.Acc_id LEFT OUTER JOIN QUALITYMASTER ON YARNRETURNWEAVER_DESC.YRETWEAVER_QUALITYID = QUALITYMASTER.QUALITY_ID LEFT OUTER JOIN LEDGERS AS TRANSPORT ON YARNRETURNWEAVER.YRETWEAVER_TRANSID = TRANSPORT.Acc_id LEFT OUTER JOIN GODOWNMASTER ON YARNRETURNWEAVER.YRETWEAVER_GODOWNID = GODOWNMASTER.GODOWN_ID left outer JOIN COLORMASTER ON YARNRETURNWEAVER_DESC.YRETWEAVER_SHADEID = COLOR_ID WHERE (YARNRETURNWEAVER_DESC.YRETWEAVER_WT - YARNRETURNWEAVER_DESC.YRETWEAVER_OUTWT)> 0  AND YARNRETURNWEAVER_DESC.YRETWEAVER_YEARID = " & YearId & " UNION ALL SELECT STOCKMASTER_YARN.SMYARN_NO AS NO, YEARMASTER.year_startdate AS DATE, ISNULL(LEDGERS.Acc_cmpname,'') AS NAME, ISNULL(GODOWNMASTER.GODOWN_NAME, '') AS GODOWN, ISNULL(TRANSPORT.Acc_cmpname, '') AS TRANSPORT, ISNULL(MILLNAME.Acc_cmpname, '') AS MILLNAME, STOCKMASTER_YARN.SMYARN_NO AS SRNO,  ISNULL(QUALITYMASTER.QUALITY_NAME, '') AS QUALITY, ISNULL(STOCKMASTER_YARN.SMYARN_BAGS - STOCKMASTER_YARN.SMYARN_OUTBAGS, 0) AS BAGS, ISNULL(STOCKMASTER_YARN.SMYARN_WT, 0) - ISNULL(STOCKMASTER_YARN.SMYARN_OUTWT, 0) AS WT, ISNULL(STOCKMASTER_YARN.SMYARN_LOTNO,'') AS LOTNO, ISNULL(COLORMASTER.COLOR_NAME,'') AS COLOR, 0 AS CONES, ISNULL(STOCKMASTER_YARN.SMYARN_LRNO, '') AS LRNO, CAST(STOCKMASTER_YARN.SMYARN_LRDATE AS VARCHAR(10)) AS LRDATE, 'OPENINGYARN' AS GRIDTYPE, STOCKMASTER_YARN.SMYARN_CMPID AS CMPID, STOCKMASTER_YARN.SMYARN_YEARID AS YEARID FROM STOCKMASTER_YARN LEFT OUTER JOIN LEDGERS ON STOCKMASTER_YARN.SMYARN_SUPPLIERID = LEDGERS.Acc_id INNER JOIN YEARMASTER ON STOCKMASTER_YARN.SMYARN_YEARID = YEARMASTER.year_id LEFT OUTER JOIN QUALITYMASTER ON STOCKMASTER_YARN.SMYARN_QUALITYID = QUALITYMASTER.QUALITY_ID LEFT OUTER JOIN LEDGERS AS TRANSPORT ON STOCKMASTER_YARN.SMYARN_TRANSPORTID = TRANSPORT.Acc_id LEFT OUTER JOIN GODOWNMASTER ON STOCKMASTER_YARN.SMYARN_GODOWNID = GODOWNMASTER.GODOWN_ID LEFT OUTER JOIN LEDGERS AS MILLNAME ON STOCKMASTER_YARN.SMYARN_MILLID = MILLNAME.Acc_id LEFT OUTER JOIN COLORMASTER ON COLOR_ID = STOCKMASTER_YARN.SMYARN_COLORID where(STOCKMASTER_YARN.SMYARN_BAGS - STOCKMASTER_YARN.SMYARN_OUTBAGS > 0) AND STOCKMASTER_YARN.SMYARN_YEARID = " & YearId & ") AS T ", where)
            Dim DT1 As DataTable = objclspreq.search(" CAST (0 AS BIT) AS CHK , * ", "", "STOCKVIEW ", where & " AND YEARID = " & YearId)
            gridbilldetails.DataSource = DT1
            If DT1.Rows.Count > 0 Then
                gridbill.FocusedRowHandle = gridbill.RowCount - 1
                gridbill.TopRowIndex = gridbill.RowCount - 15
            End If
        Catch ex As Exception
            If ErrHandle(ex.Message.GetHashCode) = False Then Throw ex
        Finally
            Cursor.Current = Cursors.Default
        End Try
    End Sub

    Private Sub cmdok_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdok.Click
        Try
            DT1.Columns.Add("NO")
            DT1.Columns.Add("DATE")
            DT1.Columns.Add("NAME")
            DT1.Columns.Add("GODOWN")
            DT1.Columns.Add("MILLNAME")
            DT1.Columns.Add("TRANSPORT")
            DT1.Columns.Add("QUALITY")
            DT1.Columns.Add("BAGS")
            DT1.Columns.Add("WT")
            DT1.Columns.Add("LOTNO")
            DT1.Columns.Add("COLOR")
            DT1.Columns.Add("CONES")
            DT1.Columns.Add("LRNO")
            DT1.Columns.Add("LRDATE")
            DT1.Columns.Add("SRNO")
            DT1.Columns.Add("GRIDTYPE")


            For i As Integer = 0 To gridbill.RowCount - 1
                Dim dtrow As DataRow = gridbill.GetDataRow(i)
                If Convert.ToBoolean(dtrow("CHK")) = True Then
                    DT1.Rows.Add(dtrow("NO"), dtrow("DATE"), dtrow("NAME"), dtrow("GODOWN"), dtrow("MILLNAME"), dtrow("TRANSPORT"), dtrow("QUALITY"), dtrow("BAGS"), dtrow("WT"), dtrow("LOTNO"), dtrow("COLOR"), dtrow("CONES"), dtrow("LRNO"), dtrow("LRDATE"), dtrow("SRNO"), dtrow("GRIDTYPE"))
                End If
            Next
            Me.Close()
        Catch ex As Exception
            If ErrHandle(ex.Message.GetHashCode) = False Then Throw ex
        End Try
    End Sub
End Class